openapi: 3.1.0
x-stoplight:
  id: tgvfiv56rre5x
info:
  title: POS PAX Public API
  version: '0.3'
  description: POS PAX API documentation
servers:
  - url: 'https://mxp-public-pos-api.dev.icadsistemi.com/v1'
    description: development
  - url: 'https://mxp-public-pos-api.prod.icadsistemi.com/v1'
    description: production
paths:
  /configuration:
    get:
      summary: POS configuration
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Configuration'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '500':
          description: Internal Server Error
      operationId: get-configuration
      description: 'First endpoint to be called after login, returns POS configuration.'
      x-internal: false
      tags:
        - Configuration
    parameters: []
  '/cards/{track}':
    get:
      summary: Card info
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Card-info'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '':
          description: ''
      operationId: get-cards
      tags:
        - Cards
    parameters:
      - schema:
          type: string
        name: track
        in: path
        required: true
  /transactions/reversal/info:
    get:
      summary: Transaction reversal info
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InfoPosTransactionReversal'
        '401':
          description: Unauthorized
        '422':
          description: Unprocessable Entity (WebDAV)
          content:
            application/json:
              schema:
                type: object
                properties: {}
        '500':
          description: Internal Server Error
      operationId: get-devices-pax-reversal-info
      parameters:
        - schema:
            type: string
          in: query
          name: card_track
        - schema:
            type: string
          in: query
          name: is_oil
      tags:
        - Transactions
    parameters: []
  /transactions/info:
    get:
      summary: Retrieve info to perform an oil or nonoil transaction
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransactionInfo'
      operationId: get-transaction-info
      description: ''
      parameters:
        - schema:
            type: string
          in: query
          name: is_oil
        - schema:
            type: string
          in: query
          name: card_track
      tags:
        - Transactions
    parameters: []
  /recharges/reversal/info:
    get:
      summary: Retrieve recharge info for reversal
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RechargesReversal'
              examples:
                Example 1:
                  value:
                    id: 529818
                    date_time: '2023-01-20T17:45:24Z'
                    bill: 100
                    bonus_credit: 20
                    update_required: false
                    requires_pin: true
        '401':
          description: Unauthorized
        '422':
          description: Unprocessable Entity (WebDAV)
        '500':
          description: Internal Server Error
      operationId: get-recharges-reversal
      parameters:
        - schema:
            type: string
          in: query
          name: card_track
      tags:
        - Recharges
    parameters: []
  /recharges:
    post:
      summary: Memorize recharge
      operationId: post-recharges
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Output'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '500':
          description: Internal Server Error
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RechargesInput'
      tags:
        - Recharges
  '/cards/{track}/recharges/bills':
    parameters:
      - schema:
          type: string
        name: track
        in: path
        required: true
    get:
      summary: Get recharges bills
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RechargesBills'
      operationId: get-cards-track-recharges-bills
      tags:
        - Recharges
  '/cards/{track}/rewards/':
    parameters:
      - schema:
          type: string
        name: track
        in: path
        required: true
        description: Track 2 of the requested card
    get:
      summary: Available rewards
      tags:
        - Rewards
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                description: List of campaign which has available rewards for the input card
                items:
                  $ref: '#/components/schemas/CampaignRewards'
        '404':
          description: Not Found
        '500':
          description: Internal Server Error
      operationId: get-rewards-track
      description: 'For point cards, return the list of available rewards, filtering with available points and active campaigns.'
  /transactions/preauth:
    post:
      summary: Preauth request
      operationId: post-transactions-preauth
      responses:
        '200':
          description: OK. You need to check inside the body to retrieve the preauth request result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PreauthResponse'
        '401':
          description: Unauthorized
        '500':
          description: Internal Server Error
      description: Used to check if the card has enough credit to perform the operation.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PreauthRequest'
              description: Preauth request data
      tags:
        - Transactions
  /transactions/oil:
    post:
      summary: ''
      operationId: post-transactions-oil
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SupplyOilOutput'
                description: Oil supply response data
      description: Used to validate and registered an oil supply using a card.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SupplyOilInput'
              description: Oil supply request data
      parameters:
        - schema:
            type: string
          in: header
          name: Authorization
          description: Auth Bearer token
      tags:
        - Transactions
  /transactions/nonoil:
    post:
      summary: ''
      operationId: post-transactions-nonoil
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SupplyNonOilOutput'
                description: Non oil supply response data
      description: Used to validate and registered a non oil supply using a card.
      parameters:
        - schema:
            type: string
          in: header
          name: Authorization
          description: Auth Bearer token
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SupplyNonOilInput'
              description: Non oil supply request data
      tags:
        - Transactions
    SupplyNonOilInput:
      type: object
      x-examples:
        Example 1:
          card_track: 70055730001000065=2209009000615800000
          total_amount: 2
          date_time: '2023-05-11T09:00:00.000'
          tran_id: 1234567890
          transaction_details:
            - article_code: '1'
              quantity: 2
              unit_price: 1
              amount: 2
          card_pin: 56ABD55E11D4FF0D2F7136943BF2E49C
      properties:
        card_track:
          type: string
          description: 'Track of the used card. Example: 70055730001000057=2209009000615800000'
        total_amount:
          type: number
          description: Transaction's total amount that the host should authorize
        date_time:
          type: string
          description: 'Request date time '
        tran_id:
          type: integer
          description: Transaction id
        transaction_details:
          type: array
          description: List of bought articles with details
          items:
            type: object
            properties:
              article_code:
                type: string
                description: Article code bought
              quantity:
                type: integer
                description: 'Article quantity '
              unit_price:
                type: number
                description: Article unit price
              amount:
                type: number
                description: 'Article amount '
            required:
              - article_code
              - quantity
              - unit_price
              - amount
        card_pin:
          type: string
          description: Card pin encrypted
      required:
        - card_track
        - total_amount
        - date_time
        - tran_id
        - transaction_details
        - card_pin
    SupplyNonOilOutput:
      type: object
      x-examples:
        Example 1:
          action_code: '000'
          approval_code: '123'
          vehicle_plate: 12ABC34
      properties:
        action_code:
          type: string
          description: The action code is the status of the request. Action codes starting with '0' are considered as a positive response.
        approval_code:
          type: string
          description: Approval code generated for positive responses.
        vehicle_plate:
          type: string
          description: Option vehicle plate binded to the card
      required:
        - action_code
  '/cards/{track}/points':
    parameters:
      - schema:
          type: string
        name: track
        in: path
        required: true
    get:
      summary: Get card point balance
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PointsOutput'
      operationId: get-cards-track-points
      tags:
        - Rewards
  /recharges/reversal:
    post:
      summary: Perform a reversal recharge
      operationId: post-recharges-reversal
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Output'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '422':
          description: Unprocessable Entity (WebDAV)
        '500':
          description: Internal Server Error
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RechargesReversalInput'
      description: ''
components:
  schemas:
    Configuration:
      type: object
      properties:
        terminal_id:
          type: integer
        supplier_id:
          type: integer
        card_types:
          type: array
          items:
            type: object
            properties:
              id:
                type: integer
              name:
                type: string
              code:
                type: integer
        measure_units:
          type: array
          items:
            type: object
            properties:
              id:
                type: integer
              name:
                type: string
              measure_unit:
                type: string
        enabled_card_types:
          type: array
          items:
            type: integer
        articles:
          type: array
          items:
            type: object
            properties:
              id:
                type: integer
              name:
                type: string
              unit_price:
                type: number
              is_oil:
                type: boolean
              price_level_id:
                type: integer
              measure_unit_id:
                type: integer
      x-examples:
        Example 1:
          terminal_id: 0
          supplier_id: 225
          card_types:
            - id: 2
              name: RICARICABILE
              code: 3
            - id: 3
              name: SCONTO
              code: 1
            - id: 4
              name: RACCOLTA PUNTI
              code: 4
            - id: 5
              name: FINEMESE
              code: 2
            - id: 6
              name: BUONO CARB.
              code: 6
          measure_units:
            - id: 1
              name: Lt
              measure_unit: L
            - id: 2
              name: Kg
              measure_unit: W
            - id: 3
              name: N.
              measure_unit: U
            - id: 4
              name: Ore
              measure_unit: H
          enabled_card_types:
            - 2
            - 3
            - 4
            - 5
            - 6
          articles:
            - id: 1172
              name: GASOLIO
              unit_price: 2.08
              is_oil: true
              price_level_id: 2
            - id: 1172
              name: GASOLIO
              unit_price: 1.998
              is_oil: true
              price_level_id: 1
            - id: 1174
              name: VERDE
              unit_price: 1.859
              is_oil: true
              price_level_id: 1
            - id: 1174
              name: VERDE
              unit_price: 2.05
              is_oil: true
              price_level_id: 2
            - id: 1176
              name: GPL
              unit_price: 0.799
              is_oil: true
              price_level_id: 2
            - id: 256
              name: Ricarica carta fuel
              unit_price: 1
              is_oil: false
              measure_unit_id: 3
            - id: 257
              name: Buoni carburante
              unit_price: 1
              is_oil: false
              measure_unit_id: 3
            - id: 2984
              name: ADBLUE TANICA
              is_oil: false
              measure_unit_id: 3
            - id: 3003
              name: OLIO
              is_oil: false
              measure_unit_id: 1
            - id: 3065
              name: LAVAGGIO BUS
              is_oil: false
              measure_unit_id: 3
            - id: 3451
              name: ACCESSORI
              is_oil: false
              measure_unit_id: 3
            - id: 3518
              name: PARCHEGGIO
              is_oil: false
              measure_unit_id: 3
            - id: 3620
              name: LAVAGGIO AUTO
              is_oil: false
              measure_unit_id: 3
            - id: 4995
              name: Marca da bollo
              unit_price: 2
              is_oil: false
              measure_unit_id: 3
            - id: 5904
              name: Spese carta Finemese
              is_oil: false
              measure_unit_id: 3
      examples:
        - terminal_id: 0
          supplier_id: 225
          card_types:
            - id: 2
              name: RICARICABILE
              code: 3
            - id: 3
              name: SCONTO
              code: 1
            - id: 4
              name: RACCOLTA PUNTI
              code: 4
            - id: 5
              name: FINEMESE
              code: 2
            - id: 6
              name: BUONO CARB.
              code: 6
          measure_units:
            - id: 1
              name: Lt
              measure_unit: L
            - id: 2
              name: Kg
              measure_unit: W
            - id: 3
              name: N.
              measure_unit: U
            - id: 4
              name: Ore
              measure_unit: H
          enabled_card_types:
            - 2
            - 3
            - 4
            - 5
            - 6
          articles:
            - id: 1172
              name: GASOLIO
              unit_price: 2.08
              is_oil: true
              price_level_id: 2
            - id: 1172
              name: GASOLIO
              unit_price: 1.998
              is_oil: true
              price_level_id: 1
            - id: 1174
              name: VERDE
              unit_price: 1.859
              is_oil: true
              price_level_id: 1
            - id: 1174
              name: VERDE
              unit_price: 2.05
              is_oil: true
              price_level_id: 2
            - id: 1176
              name: GPL
              unit_price: 0.799
              is_oil: true
              price_level_id: 2
            - id: 256
              name: Ricarica carta fuel
              unit_price: 1
              is_oil: false
              measure_unit_id: 3
            - id: 257
              name: Buoni carburante
              unit_price: 1
              is_oil: false
              measure_unit_id: 3
            - id: 2984
              name: ADBLUE TANICA
              is_oil: false
              measure_unit_id: 3
            - id: 3003
              name: OLIO
              is_oil: false
              measure_unit_id: 1
            - id: 3065
              name: LAVAGGIO BUS
              is_oil: false
              measure_unit_id: 3
            - id: 3451
              name: ACCESSORI
              is_oil: false
              measure_unit_id: 3
            - id: 3518
              name: PARCHEGGIO
              is_oil: false
              measure_unit_id: 3
            - id: 3620
              name: LAVAGGIO AUTO
              is_oil: false
              measure_unit_id: 3
            - id: 4995
              name: Marca da bollo
              unit_price: 2
              is_oil: false
              measure_unit_id: 3
            - id: 5904
              name: Spese carta Finemese
              is_oil: false
              measure_unit_id: 3
    Card-info:
      type: object
      x-examples:
        Example 1:
          id: 0
          is_enabled: true
          type_id: 0
      description: Card type and status informations
      properties:
        is_enabled:
          type: boolean
        type_id:
          type: integer
        update_required:
          type: boolean
    Supplies-info:
      type: object
      properties:
        customer_data:
          type: array
          items:
            type: integer
        articles:
          type: array
          items:
            type: integer
        requires_pin:
          type: boolean
      x-examples:
        Example 1:
          customer_data:
            - 2
            - 3
          articles:
            - 3
            - 4
            - 8
          requires_pin: true
    SupplyNonOilInput:
      type: object
      x-examples:
        Example 1:
          card_track: 70055730001000065=2209009000615800000
          total_amount: 2
          date_time: '2023-05-11T09:00:00.000'
          tran_id: 1234567890
          transaction_details:
            - article_code: '1'
              quantity: 2
              unit_price: 1
              amount: 2
          card_pin: 56ABD55E11D4FF0D2F7136943BF2E49C
      properties:
        card_track:
          type: string
          description: 'Track of the used card. Example: 70055730001000057=2209009000615800000'
        total_amount:
          type: number
          description: Transaction's total amount that the host should authorize
        date_time:
          type: string
          description: 'Request date time '
        tran_id:
          type: integer
          description: Transaction id
        transaction_details:
          description: List of bought articles with details
          type: array
          items:
            type: object
            properties:
              article_code:
                type: string
                description: Article code bought
              quantity:
                type: integer
                description: 'Article quantity '
              unit_price:
                type: number
                description: Article unit price
              amount:
                type: number
                description: 'Article amount '
            required:
              - article_code
              - quantity
              - unit_price
              - amount
        card_pin:
          type: string
          description: Card pin encrypted
      required:
        - card_track
        - total_amount
        - date_time
        - tran_id
        - transaction_details
        - card_pin
    SupplyNonOilOutput:
      type: object
      x-examples:
        Example 1:
          action_code: '000'
          approval_code: '123'
          vehicle_plate: 12ABC34
      properties:
        action_code:
          type: string
          description: The action code is the status of the request. Action codes starting with '0' are considered as a positive response.
        approval_code:
          type: string
          description: Approval code generated for positive responses.
        vehicle_plate:
          type: string
          description: Option vehicle plate binded to the card
      required:
        - action_code
    Articles:
      title: Articles
      x-stoplight:
        id: 8db3394aaad8f
      type: array
      description: Articles model for info pos transaction reversal model
      items:
        type: object
        properties:
          article_name:
            type: string
            description: name of the article
          amount:
            type: number
            description: amount of the transaction
          unit_price:
            type: number
            description: unit price of the transaction
          quantity:
            type: number
            description: quantity of the transaction
    InfoPosTransactionReversal:
      title: InfoPosTransactionReversal
      x-stoplight:
        id: 3holszdjt79rb
      type: object
      examples: []
      properties:
        id:
          type: integer
          description: transaction id unique
        date_time:
          type: string
          format: date-time
          description: data time of the transaction
          readOnly: true
        articles:
          $ref: '#/components/schemas/Articles'
          description: articles model of the transaction
        update_required:
          type: boolean
          description: true if the terminal must update its settings
        requires_pin:
          type: boolean
          description: 'true if the pin mandatory for the next reversal '
        is_oil:
          type: boolean
          customer_data:
            - 2
            - 3
          is_oil: false
          articles:
            - 3
            - 4
            - 8
          requires_pin: true
    RechargesReversal:
      title: RechargesReversal
      x-stoplight:
        id: zcwnf9vyzktqx
      type: object
      properties:
        id:
          type: integer
          description: id unique
        date_time:
          type: string
          format: date-time
          readOnly: true
        bill:
          type: number
        bonus_credit:
          type: number
        update_required:
          type: boolean
          description: true if the terminal must update its settings
        requires_pin:
          type: boolean
          description: 'true if the pin mandatory for the next reversal '
    CampaignRewards:
      title: CampaignRewards
      x-stoplight:
        id: qjbhk1o80xtrn
      type: object
      description: A campaign with all its rewards
      properties:
        id:
          type: integer
          description: ID of the campaign
        name:
          type: string
          description: Name of the campaign
        type:
          type: integer
          description: |-
            Allowed values are:

            - 1: this is a OIL campaign
            - 2: this is a NON OIL campaign
            - 3: this is a mixed campaign
        rewards:
          type: array
          description: Arrray of available rewards
          items:
            $ref: '#/components/schemas/Reward'
      required:
        - id
        - name
        - type
        - rewards
    RechargesInput:
      type: object
      x-examples:
        Example 1:
          card_track: 70055730001000057=2209009000615800000
          bill_id: 53
          pin: 68B4E28A576654D1
          payment_mode: 2
          key_label: QT_IFSF
          random_pin_key: 2C9E11B025F712CA37437D853BD6E7D4
          transaction_id: ''
      properties:
        card_track:
          type: string
        bill_id:
          type: integer
        pin:
          type: string
        payment_mode:
          type: integer
        key_label:
          type: string
        random_pin_key:
          type: string
        transaction_id:
          type: string
      required:
        - card_track
        - bill_id
        - pin
        - key_label
        - random_pin_key
        - transaction_id
    RechargesBills:
      type: object
      properties:
        bills:
          type: array
          items:
            type: object
            properties:
              id:
                type: integer
              amount:
                type: integer
              bonus_credit:
                type: integer
        update_required:
          type: boolean
      x-examples:
        Example 1:
          bills:
            - id: 15
              amount: 50
              bonus_credit: 1
          update_required: false
    PreauthRequest:
      title: PreauthRequest
      x-stoplight:
        id: t7g43q1jbdgvy
      type: object
      description: Used to create a preauthorization request
      properties:
        card_track:
          type: string
          description: 'Track of the used card. Example: 70055730001000057=2209009000615800000'
        random_pin_key:
          type: string
          description: Random pin key used to generate the session encryption key
        label_key:
          type: string
          description: Label used to recognize which key use on server side
        crypted_pin:
          type: string
          description: The pin encrypted with the session key
        datetime:
          type: string
          description: Datetime of the request
          format: date-time
        total_amount:
          type: number
          description: Amount requested to be authorized
        tran_id:
          type: integer
          description: Transaction id
      required:
        - card_track
        - random_pin_key
        - label_key
        - crypted_pin
        - datetime
        - total_amount
        - tran_id
    PreauthResponse:
      title: PreauthResponse
      x-stoplight:
        id: 6nlcd7ng8mgkw
      type: object
      properties:
        action_code:
          type: string
          description: The action code is the status of the request. Action codes starting with '0' are considered as a positive response.
        approval_code:
          type: string
          description: Approval code generated for positive responses.
        authorized_amount:
          type: number
          description: The authorized amount with this request
        available_products:
          type: array
          description: Products available for this card
          items:
            type: string
        vehicle_plate:
          type: string
          description: Option vehicle plate binded to the card
        icc_data:
          type: string
          description: 'ICC data, for EMV transactions'
        balance_amount:
          type: number
          description: Total balance amount
      required:
        - action_code
        - approval_code
        - authorized_amount
        - available_products
        - vehicle_plate
        - icc_data
        - balance_amount
    SupplyOilInput:
      title: SupplyOilInput
      x-stoplight:
        id: 6pd5lgrxsz2xt
      type: object
      description: Input model for the supplies requests
      properties:
        card_track:
          type: string
          description: 'Track of the used card. Example: 70055730001000057=2209009000615800000'
        tran_id:
          type: integer
          description: Transaction id
        products:
          type:
            - array
          description: List of products bought
          items:
            type: object
            properties:
              product_code:
                type: string
                description: Product's code
              unit_of_measure:
                type: string
                description: Product's unit of measure
              quantity:
                type: number
                description: Product's quantity
              unit_price:
                type: number
                description: Product's unit price
              amount:
                type: number
                description: Product's amount
            required:
              - product_code
              - unit_of_measure
              - quantity
              - unit_price
              - amount
        random_pin_key:
          type: string
          description: Random pin key used to generate the session encryption key
        label_key:
          type: string
          description: Label used to recognize which key use on server side
        crypted_pin:
          type: string
          description: The pin encrypted with the session key
        date_time:
          type: string
          description: 'Request date time '
        total_amount:
          type: number
          description: Transaction's total amount that the host should authorize
        km:
          type: integer
          description: Vehicle's kilometers
        drivercode:
          type: integer
        vehiclecode:
          type: string
        pos_data_code:
          type: string
        function_code:
          type: string
        message_reason_code:
          type: string
        batch_number:
          type: string
        currency_code:
          type: string
        icc_related_data:
          type: string
        unencrypted_id:
          type: string
        work_order:
          type: string
        vehicle_number:
          type: string
        driver_id:
          type: string
        service_level:
          type: boolean
          description: 'Represent the operative mode: True means SelfServe, False means FullServe, Null means NotSpecified'
        delivery_note_number:
          type: string
        default_vat:
          type: string
      required:
        - card_track
        - tran_id
        - products
        - random_pin_key
        - label_key
        - crypted_pin
        - date_time
        - total_amount
    SupplyOilOutput:
      type: object
      x-examples:
        Example 1:
          action_code: '000'
          approval_code: '123'
          vehicle_plate: 12ABC34
          icc_data: DF2003ABCDEF
      description: Output model for the supplies requests
      properties:
        action_code:
          type: string
          description: The action code is the status of the request. Action codes starting with '0' are considered as a positive response.
        approval_code:
          type: string
          description: Approval code generated for positive responses.
        vehicle_plate:
          type: string
          description: Option vehicle plate binded to the card
        icc_data:
          type: string
          description: 'ICC data, for EMV transactions'
      required:
        - action_code
    PointsOutput:
      type: object
      properties:
        points:
          type: integer
      x-examples:
        Example 1:
          points: 0
    RechargesReversalInput:
      type: object
      properties:
        card_track:
          type: string
        recharge_id:
          type: integer
        pin:
          type: string
        key_label:
          type: string
        random_pin_key:
          type: string
        transaction_id:
          type: string
      x-examples:
        Example 1:
          card_track: 1234567890=12345678900987654321
          recharge_id: 531303
          pin: IFGHERYIGEGTRH
          key_label: ASDFGHJ
          random_pin_key: GERGRDHE6HVJYJ TRJFJTYJRTJ
          transaction_id: '32894987453'
    Output:
      type: object
      x-examples:
        Example 1:
          result: '000'
      properties:
        result:
          type: string
        ticket:
          type: string
  securitySchemes:
    Cognito:
      type: oauth2
      flows:
        password:
          tokenUrl: ''
          refreshUrl: ''
          scopes: {}
      description: ''
  responses: {}
security:
  - Cognito: []
